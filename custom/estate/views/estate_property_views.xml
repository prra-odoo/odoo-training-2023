<?xml version='1.0'?>
<odoo>
    <record id='estate_property_action' model='ir.actions.act_window'>
        <field name='name'>Properties</field>
        <field name='res_model'>estate.property</field>
        <field name='view_mode'>tree,form,kanban</field>
        <field name='context'>{'search_default_available' : True}</field>
         <field name='help' type='html'>
          <p class='o_view_nocontent_smiling_face'>
            Create your first property
          </p>
        </field>
    </record>

    <record id='estate_property_kanban' model='ir.ui.view'>
        <field name='name'>estate.property.kanban</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <kanban default_group_by='property_type_id' class='o_kanban_dashboard o_project_kanban o_emphasize_colors'> 
                <field name='state'/>
                <field name='property_type_id' readonly='1'/>
                <field name="kanbancolor"/>
                <field name="priority"/>
                <field name="buyer_id"/>
                <templates>
                    <t t-name='kanban-box'>
                        <div t-attf-class='oe_kanban_color_#{kanban_getcolor(record.kanbancolor.raw_value)} oe_kanban_global_click'>
                            <div class='o_kanban_record_title mb-2'><field class='me-2' name="priority" widget="priority"/><field name="name"/></div>
                            <span class="o_text_overflow text-muted" t-if="record.buyer_id.value">
                                <span class="fa fa-user me-2" aria-label="Buyer" title="Buyer"/><t t-esc="record.buyer_id.value"/>
                            </span>
                            <div>Expected Price: <field name='expected_price'/></div>
                            <div t-if='record.state.raw_value != "new"'>Best Offer: <field name='best_price'/></div>
                            <div t-if='record.state.raw_value == "sold"'>Selling Price: <field name='selling_price'/></div>
                            <div class="row mt-3 align-items-center">
                                <div class="col-8">
                                    <div class='text-muted'><field name='tag_ids' widget='many2many_tags' options='{"color_field": "color"}'/></div>
                                </div>
                                <div class="col-4">
                                    <div class="oe_kanban_bottom_right float-end">
                                        <field name="seller_id" widget="many2one_avatar_user"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id='estate_property_tree' model='ir.ui.view'>
        <field name='name'>estate.property.tree</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <tree string='Estate Property Tree' 
            decoration-success='state in ("offer received","offer accepted")'
            decoration-bf='state=="offer accepted"'
            decoration-muted='state=="sold"'
            decoration-danger='state=="canceled"'>
                <field name='number'/>
                <field name='name'/>
                <field name='property_type_id'/>
                <field name='postcode'/>
                <field name='tag_ids' widget='many2many_tags' options='{"color_field": "color"}'/>
                <field name='bedrooms'/>
                <field name='living_area' optional='show'/>
                <field name='expected_price'/>
                <field name='selling_price'/>
                <field name='date_availability' optional='hidden'/>
                <field name='state' optional='hidden'/>
            </tree>
        </field>
    </record>

    <record id="property_task_order" model="ir.sequence">
        <field name="name">Task Number</field>
        <field name="code">estate.property</field>
        <field name="prefix">PR</field>
        <field name="padding">3</field>
    </record>

    <record id='estate_property_form' model='ir.ui.view'>
        <field name='name'>estate.property.form</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <form string='Estate Property Form'>
                <header>
                    <button name='action_sold' states='new,offer received' string='Sold' type='object'/>
                    <button name='action_sold' states='offer accepted' string='Sold' type='object' class='oe_highlight'/>
                    <button name='action_cancel' states='new,offer received,offer accepted' string='Cancel' type='object'/>
                    <field name='state' widget='statusbar'/>
                </header>
                <div class='oe_chatter'>
                    <field name='message_follower_ids'/>
                    <field name='message_ids'/>
                    <field name='activity_ids'/>
                </div>
                <sheet>
                    <widget name='web_ribbon' title='Sold' bg_color='bg-success' attrs='{"invisible": [("state", "not in", ["sold"])]}'/>
                    <widget name='web_ribbon' title='Canceled' bg_color='bg-danger' attrs='{"invisible": [("state", "not in", ["canceled"])]}'/>
                    <div>
                        <label for='name' string='Property'/>
                        <h1><field name='name' placeholder='Title'/></h1>
                    </div>
                        <field name='tag_ids' nolabel='1' options='{"color_field": "color"}' widget='many2many_tags' placeholder='tags'/>
                    <group>
                        <group>
                            <field name='property_type_id' options='{"no_create":True}'/>
                            <field name='postcode'/>
                            <field name='date_availability'/>
                        </group>
                        <group>
                            <field name='expected_price'/>
                            <field name='best_price'/>
                            <field name='selling_price'/>
                        </group>
                        <notebook>
                            <page string='Description'>
                                <group>
                                    <group>
                                        <field name='description'/>
                                        <field name='bedrooms'/>
                                        <field name='living_area' string='Living Area(sqm)'/>
                                        <field name='facades'/>  
                                        <field name='garage'/>
                                        <field name='garden'/>
                                        <field name='garden_orientation' string='Garden Orientation' attrs='{"invisible": [("garden", "=", False)]}'/>
                                        <field name='garden_area' string='Garden Area(sqm)' attrs='{"invisible": [("garden", "=", False)]}'/>
                                        <field name='total_area' string='Total Area (sqm)'/>
                                    </group>
                                </group>
                            </page>
                            <page string='Offers'>
                                <field name='offer_ids' attrs='{"readonly": [("state", "in", ["offer accepted", "sold", "canceled"])]}'></field>
                            </page>
                            <page string='Other Info'>
                                <group>
                                    <group>
                                        <group>
                                            <field name='buyer_id'/>
                                            <field name='seller_id'/>
                                        </group>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id='estate_property_search' model='ir.ui.view'>
        <field name='name'>estate.property.search</field>
        <field name='model'>estate.property</field>
        <field name='arch' type='xml'>
            <search string='Estate Property Search'>
                <field name='name' string='Title' />
                <field name='postcode'/>
                <field name='property_type_id'/>
                <field name='expected_price'/>
                <field name='bedrooms'/>
                <field name='living_area' string='Living Area (sqm)'
                filter_domain='[("living_area", ">=", self)]'/>
                <field name='facades'/>
                <filter string='Archived' name='inactive' domain='[("active", "=", False)]'/>
                <separator/>
                <filter string='Available' name='available' domain='["|", ("state","=","new"),("state","=","offer received")]'/>
                <group expand='1' string='Group By'>
                    <filter string='Postcode' name='postcode' context='{"group_by":"postcode"}'/>
                </group> 
            </search>
        </field>
    </record>
</odoo>